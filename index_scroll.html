<html>
    <head>
        <title>Quran?</title>
        <script src="https://d3js.org/d3.v3.min.js"></script>
<!--         <script src="https://cdn.rawgit.com/anvaka/panzoom/v4.4.0/dist/panzoom.min.js"></script> -->
        <script src = "quran_json_string.js"></script>
        <script src = "prophet_json_string.js"></script>
        <script src = "names99_string.js"></script>
        <link rel="stylesheet" type="text/css" href="style.css">

    </head>
    <body >

    	<div id="infobox" style="position: fixed; width: 85%; top:0%; z-index: 100; background:green; padding:5px; ">
			<div id="arabic_text_p"> Aya Text </div>
			<div id="english_text_p"> English Translation </div>
			<div   >
				<div id="sura_text_p" style="float: left;"> Surah Number </div>
				<div  style="float: left;"> &emsp; </div>
				<div id="aya_text_p" style="float: left;"> Aya Number </div>
				<div  style="float: left;"> &emsp; </div>
				<div id="juz_text_p" style="float: left;"> Juz Number </div>
			</div>
		</div>


<!--     <div class="row"> -->
    	<div class="column" style="position: fixed; top: 10%">
    		<div class="topnav" align="center">
				<input id="search_text_bar" type="text" size="45" placeholder="Search for a term in the English translation"> <button id="search_button" > Search! </button>
			</div>

<!-- 
			<p id="arabic_text_p" align="center"> Aya Text </p>
			<p id="english_text_p" align="center"> English Translation </p>
			<p id="sura_text_p" align="center"> Surah Number </p>
			<p id="aya_text_p" align="center"> Aya Number </p>
			<p id="juz_text_p" align="center"> Juz Number </p>
 -->
			<div id="quran_container" style="position: fixed; top: 15%">
			</div>
		</div>


		<div id="navbar" class="vertical-menu" style="position: fixed; width: 10%; left: 88%; top: 0%">
		  <a href="#IntroductionAnchor" class="btn active">Introduction</a>
		  <a href="#RevelationAnchor" class="btn">Revelation</a>
		  <a href="#ChaptersAnchor" class="btn">Chapters</a>
  		  <a href="#OpeningAnchor" class="btn">Opening</a>
		  <a href="#JesusAnchor" class="btn">Jesus</a>
		  <a href="#ProphetsAnchor" class="btn">Prophets</a>
		  <a href="#99NamesAnchor" class="btn">99 Names of God</a>
		</div>


    	<div class="column" id="content" style="position: absolute; width: 40%; height: 100%; left: 45%; top: 25%">


		<span class="anchor" id="IntroductionAnchor"></span>
		<section class="step" id="Introduction">
	      The Quran is the holy book ascribed to by over 1.5 billion Muslims across the world. Muslims worship the same God as Jews and Christians, and they believe the Quran to be the direct word of God transmitted through the final prophet Muhammad (Peace Be Upon Him). On the left, you can see a searchable/dynamic representation of the Quran and an English translation by Yusuf Ali*. You can mouse-over each Aya (section) to highilhgt it and see what it says.

	      <p>
	      <img src="images/love_quran.jpg" width=100%>
	    </section>


		<span class="anchor" id="RevelationAnchor"></span>
	    <section class="step" id="Revelation">

	    	Muhammad did not know how to read or write, nor did he have knowledge of previous scriptures. He lived in Mecca in the Arabian peninsula at a time of idolatry, social corruption, and injustice. Muslims believe that the angel Gabriel visited Muhammad while he was meditating in the cave of Hira. 

	    	<img src="images/hira_map.PNG" width=100%>
	    	<p>

	    	The angel Gabriel informed the illiterate Muhammad to recite the Quran. The words were captured in the chapter Al-Alaq.

			<p>
	    	<div class="aya" surah=96 aya=1></div>
	    	<p>
	    	<div class="ayaEnglish"> 
	    	Recite in the name of your Lord who created -
	    	</div>

	    	<p>
	    	<div class="aya" surah=96 aya=2></div>
	    	<p>
	    	<div class="ayaEnglish"> 
	    	Created man from a clinging substance.
	    	</div>

			<p>
	    	<div class="aya" surah=96 aya=3></div>
	    	<p>
	    	<div class="ayaEnglish"> 
	    	Recite, and your Lord is the most Generous - 
	    	</div>

			<p>
	    	<div class="aya" surah=96 aya=4></div>
			<p>
			<div class="ayaEnglish"> 
	    	Who taught by the pen -
	    	</div>

			<p>
	    	<div class="aya" surah=96 aya=5></div>
			<p>
			<div class="ayaEnglish"> 
	    	Taught man that which he knew not.
	    	</div>


	    </section>


	    <span class="anchor" id="ChaptersAnchor"></span>
	    <section class="step" id="Chapters">
	    	The Quran is a compilation of revelations that Muhammad received as the final prophet. The Quran is organized into 114 chapters (Surahs). Every chapter, except one, begins with the line: 
	    	
	    	<p>
	    	<img src="images/bismillah.jpg" width=100%>

	    	<p>
	    	In the name of Allah, the Entirely Merciful, the Especially Merciful.

	    	<p>
	    	Muslims begin almost everything they do with this line, including eating, traveling, and business dealings.

	    	<p>
	    	The Quran is not organized in chronological order of revelation. Instead, it was compiled according to an order of recitation described by the prophet. Many of the beginning Surah's are long, and many at the end are shorter. In addition, the book is also organized into 30 sections of equal parts. This is useful for those who are reciting the Quran during the month of Ramadan. Each column in the visualization represents a different section.

	    </section>

		<span class="anchor" id="OpeningAnchor"></span>
	    <section class="step" id="Opening">

	    	The first chapter in the Quran is referred to as the "Opening" (Al-Fatiha). It is composed of seven lines. These are recited in each cycle of every muslim prayer. The lines go:

	    	<p>
	    	<div class="aya" surah=1 aya=1></div>
	    	<p>
	    	<div class="ayaEnglish"> 
	    	In the name of Allah, the Entirely Merciful, the Especially Merciful.
	    	</div>

	    	<p>
	    	<div class="aya" surah=1 aya=2></div>
	    	<p>
	    	<div class="ayaEnglish"> 
	    	[All] praise is [due] to Allah, Lord of the worlds -
	    	</div>

	    	<p>
	    	<div class="aya" surah=1 aya=3></div>
	    	<p>
	    	<div class="ayaEnglish"> 
	    	The Entirely Merciful, the Especially Merciful,
	    	</div>

	    	<p>
	    	<div class="aya" surah=1 aya=4></div>
	    	<p>
	    	<div class="ayaEnglish"> 
	    	Sovereign of the Day of Recompense.
	    	</div>

	    	<p>
	    	<div class="aya" surah=1 aya=5></div>
	    	<p>
	    	<div class="ayaEnglish"> 
	    	It is You we worship and You we ask for help.
	    	</div>

	    	<p>
	    	<div class="aya" surah=1 aya=6></div>
	    	<p>
	    	<div class="ayaEnglish"> 
	    	Guide us to the straight path -
	    	</div>

	    	<p>
	    	<div class="aya" surah=1 aya=7></div>
	    	<p>
	    	<div class="ayaEnglish"> 
	    	The path of those upon whom You have bestowed favor, not of those who have evoked [Your] anger or of those who are astray.
	    	</div>

	    </section>

		<span class="anchor" id="JesusAnchor"></span>
	    <section class="step" id="Jesus">
	    	Since the Quran is assumed to be from the same source as the Gospel and the Torah, it is no surprise that there is mention of the same stories and people. The written Quran was compiled very quickly after Muhammad's death, within the lifeteimes of those who had memorized it. Manuscripts have been discovered and radio-carbon dated to the time of the Prophet. 

	    	<p>
	    	<img src="images/Birmingham_Quran_manuscript.jpg" width=100%>

	    	<p>
	    	In Islam, Muhammad, Jesus, Moses, and all the prophets are considered non-divine humans who deliver the message of God to the believers. Muslims believe in the virgin-birth of Jesus, but the Quran is clear that he was not divine and was not the son of God. That doesn't stop Jesus from playing a central role in Islam. Jesus is mentioned by name 25 times in the Quran, while Muhammad is mentioned only 4 times by name.

	    	<p>
	    	Here we highlight all the times Jesus is mentioned in Green and Mary in Purple.

	    </section>

		<span class="anchor" id="ProphetsAnchor"></span>
	    <section class="step" id="Prophets">

	    	In fact, you can explore all the prophets and their mentions by name. Highlight your mouse over the name to see where they are mentioned.

	    	<p>
	    	<p>

	    	<div id="prophetTable">
	    	</div>
<!-- 
	    	<table width="100%">
	    		<tr>
	    			<td>
	    				<div class="prophet">
	    					Noah (English)
	    					Nuh (Arabic)
	    				</div>
	    			</td>
	       			<td>
	    				<div class="prophet">
	    					Noah (English)
	    					Nuh (Arabic)
	    				</div>	       				
	    			</td>
	    			<td>
	    				<div class="prophet">
	    					Noah (English)
	    					Nuh (Arabic)
	    				</div>	    				
	    			</td>
	       			<td>
	    				<div class="prophet">
	    					Noah (English)
	    					Nuh (Arabic)
	    				</div>	       				
	    			</td>
	    			<td>
	    				<div class="prophet">
	    					Noah (English)
	    					Nuh (Arabic)
	    				</div>	    				
	    			</td>
	    		</tr>
	    		<tr>
	    			<td>
	    				<div class="prophet">
	    					Noah (English)
	    					Nuh (Arabic)
	    				</div>
	    			</td>
	       			<td>
	    				<div class="prophet">
	    					Noah (English)
	    					Nuh (Arabic)
	    				</div>	       				
	    			</td>
	    			<td>
	    				<div class="prophet">
	    					Noah (English)
	    					Nuh (Arabic)
	    				</div>	    				
	    			</td>
	       			<td>
	    				<div class="prophet">
	    					Noah (English)
	    					Nuh (Arabic)
	    				</div>	       				
	    			</td>
	    			<td>
	    				<div class="prophet">
	    					Noah (English)
	    					Nuh (Arabic)
	    				</div>	    				
	    			</td>
	    		</tr>
	    		<tr>
	    			<td>
	    				<div class="prophet">
	    					Noah (English)
	    					Nuh (Arabic)
	    				</div>
	    			</td>
	       			<td>
	    				<div class="prophet">
	    					Noah (English)
	    					Nuh (Arabic)
	    				</div>	       				
	    			</td>
	    			<td>
	    				<div class="prophet">
	    					Noah (English)
	    					Nuh (Arabic)
	    				</div>	    				
	    			</td>
	       			<td>
	    				<div class="prophet">
	    					Noah (English)
	    					Nuh (Arabic)
	    				</div>	       				
	    			</td>
	    			<td>
	    				<div class="prophet">
	    					Noah (English)
	    					Nuh (Arabic)
	    				</div>	    				
	    			</td>
	    		</tr>
	    		<tr>
	    			<td>
	    				<div class="prophet">
	    					Noah (English)
	    					Nuh (Arabic)
	    				</div>
	    			</td>
	       			<td>
	    				<div class="prophet">
	    					Noah (English)
	    					Nuh (Arabic)
	    				</div>	       				
	    			</td>
	    			<td>
	    				<div class="prophet">
	    					Noah (English)
	    					Nuh (Arabic)
	    				</div>	    				
	    			</td>
	       			<td>
	    				<div class="prophet">
	    					Noah (English)
	    					Nuh (Arabic)
	    				</div>	       				
	    			</td>
	    			<td>
	    				<div class="prophet">
	    					Noah (English)
	    					Nuh (Arabic)
	    				</div>	    				
	    			</td>
	    		</tr>
	    		<tr>
	    			<td>
	    				<div class="prophet">
	    					Noah (English)
	    					Nuh (Arabic)
	    				</div>
	    			</td>
	       			<td>
	    				<div class="prophet">
	    					Noah (English)
	    					Nuh (Arabic)
	    				</div>	       				
	    			</td>
	    			<td>
	    				<div class="prophet">
	    					Noah (English)
	    					Nuh (Arabic)
	    				</div>	    				
	    			</td>
	       			<td>
	    				<div class="prophet">
	    					Noah (English)
	    					Nuh (Arabic)
	    				</div>	       				
	    			</td>
	    			<td>
	    				<div class="prophet">
	    					Noah (English)
	    					Nuh (Arabic)
	    				</div>	    				
	    			</td>
	    		</tr>	    			    			    			    		
	    	</table> -->
	    </section>

		<span class="anchor" id="99NamesAnchor"></span>
	    <section class="step" id="99Names">
	    	Muslims believe that God has 99 names or attributes. These attributes are names that God refers to throughout the Quran. When Muslims pray and ask for grace from God, they often utilize the sepcialization of these names.

			<p>
	    	<div class="aya" surah=59 aya=24></div>
			<p>
			<div class="ayaEnglish"> 
			He is Allah, the Creator, the Inventor, the Fashioner; to Him belong the best names. Whatever is in the heavens and earth is exalting Him. And He is the Exalted in Might, the Wise.
			</div>

			<p>
			99 names box:
			<div id="names99Table">
	    	</div>

	    </section>


    	</div>
<!--     </div> -->


	<script>

		//freeform
		//Surah al-Alaq
		//Surah colors
		//al-fatiha
		//Jesus green, mary purple
		//All prophets table
		//99 names box

		//set up search bar
		document.getElementById('search_button').onclick=search;

		//set up navigation bar:
		function setupNavBar(){
			// Get the container element
			var btnContainer = document.getElementById("navbar");

			// Get all buttons with class="btn" inside the container
			var btns = btnContainer.getElementsByClassName("btn");

			// Loop through the buttons and add the active class to the current/clicked button
			for (var i = 0; i < btns.length; i++) {
			  btns[i].addEventListener("click", function() {
			    var current = document.getElementsByClassName("active");
			    current[0].className = current[0].className.replace(" active", "");
			    this.className += " active";
			  });
			}			
		}
		setupNavBar();


		var prophetDivList = [];
		function setupProphetTable(){
			var table = document.getElementById('prophetTable');

			var numRows = 5;
			var numCols = 5;

			var rowDiv = null;
			for(var i = 0; i<prophet_json_string.length; i++){
				var row = Math.floor(i/numCols);
				var col = i%numCols;


				if(col==0){
					//add new row!
					var newRowDiv = document.createElement("div");
					newRowDiv.classList.add("prophetRow");
					table.appendChild(newRowDiv);
					rowDiv = newRowDiv;
				}

				//add new column element
				var newColDiv = document.createElement("div");
				newColDiv.classList.add("prophetColumn");
				newColDiv.index = i;
				prophetDivList.push(newColDiv);

				if(i%2==0){
					newColDiv.classList.add("prophetOffColor");
				}

				var englishDiv = document.createElement("div");
				englishDiv.classList.add("prophetEnglish");
				englishDiv.innerHTML = prophet_json_string[i].EnglishName;
				newColDiv.appendChild(englishDiv);

				var transliteratedDiv = document.createElement("div");
				transliteratedDiv.classList.add("prophetTransliterated");
				transliteratedDiv.innerHTML = prophet_json_string[i].TransliteratedName;
				newColDiv.appendChild(transliteratedDiv);

				var arabicDiv = document.createElement("div");
				arabicDiv.classList.add("prophetArabic");
				arabicDiv.innerHTML = prophet_json_string[i].ArabicName;
				newColDiv.appendChild(arabicDiv);

				newColDiv.addEventListener('click', function (event) {
					console.log('prophet selected: ' + prophet_json_string[this.index].TranslationName);
					searchTerm(prophet_json_string[this.index].TranslationName);

					for(var jj = 0; jj<prophetDivList.length; jj++){
						prophetDivList[jj].classList.remove('prophetSelected');
					}
					this.classList.add('prophetSelected');
		        });

				rowDiv.appendChild(newColDiv);

			}

		}
		setupProphetTable();

		var names99DivList = [];
		function setupNamesTable(){
			var table = document.getElementById('names99Table');

			var numRows = 10;
			var numCols = 10;

			var rowDiv = null;
			for(var i = 0; i<names99_string.length; i++){
				var row = Math.floor(i/numCols);
				var col = i%numCols;


				if(col==0){
					//add new row!
					var newRowDiv = document.createElement("div");
					newRowDiv.classList.add("names99Row");
					table.appendChild(newRowDiv);
					rowDiv = newRowDiv;
				}

				//add new column element
				var newColDiv = document.createElement("div");
				newColDiv.classList.add("names99Column");
				newColDiv.index = i;
				prophetDivList.push(newColDiv);

				if(i%2==0){
					newColDiv.classList.add("names99OffColor");
				}

				var englishDiv = document.createElement("div");
				englishDiv.classList.add("names99English");
				englishDiv.innerHTML = names99_string[i].Translation;
				newColDiv.appendChild(englishDiv);

				var transliteratedDiv = document.createElement("div");
				transliteratedDiv.classList.add("names99Transliterated");
				transliteratedDiv.innerHTML = names99_string[i].Transliteration;
				newColDiv.appendChild(transliteratedDiv);

				var arabicDiv = document.createElement("div");
				arabicDiv.classList.add("names99Arabic");
				arabicDiv.innerHTML = names99_string[i].Arabic;
				newColDiv.appendChild(arabicDiv);

				newColDiv.addEventListener('click', function (event) {
					console.log('names99 selected: ' + names99_string[this.index].Translation);
					//searchTermArabic(names99_string[this.index].Arabic);
					searchTerm(names99_string[this.index].Translation);

					for(var jj = 0; jj<prophetDivList.length; jj++){
						names99DivList[jj].classList.remove('names99Selected');
					}
					this.classList.add('names99Selected');
		        });

				rowDiv.appendChild(newColDiv);

			}
		}
		setupNamesTable();


		function setupArabicText(){
			console.log("setting up arabic text");
			var ayas = document.getElementsByClassName("aya");
			for(var i = 0; i<ayas.length; i++){
				var surah = parseInt(ayas[i].getAttribute("surah"));
				var aya = parseInt(ayas[i].getAttribute("aya"));
				var text = "";
				for(var jj = 0; jj<quran_json_string.length; jj++){
					if(quran_json_string[jj].chapter === surah & quran_json_string[jj].verse === aya){
						ayas[i].innerHTML = surah + ":" + aya + " " + quran_json_string[jj].arabic;
					}
				}

				//console.dir(ayas[i]);
				//console.log("aya element surah: " + ayas[i].getAttribute("surah") + " " + ayas[i].getAttribute("aya"));
			}
		}
		setupArabicText();


		function shuffleArray(array) {
		    for (var i = array.length - 1; i > 0; i--) {
		        var j = Math.floor(Math.random() * (i + 1));
		        var temp = array[i];
		        array[i] = array[j];
		        array[j] = temp;
		    }

		}


		var interval = null;


		function red(){
			for(i = 0; i<box_list.length; i++){
				box_list[i].transition()
    						.duration(800)
    						.attr('fill', 'red')				
			}

		}

		function green(){
			for(i = 0; i<box_list.length; i++){
				box_list[i].transition()
    						.duration(800)
    						.attr('fill', 'green')				
			}

		}

		function blue(){
			for(i = 0; i<box_list.length; i++){
				box_list[i].transition()
    						.duration(800)
    						.attr('fill', 'blue')					
			}

		}

		function nada(progress){

		}

		function redP(progress){

		}

		var freeformCleared = 0;
		function freeform(){
			if(!freeformCleared){
				for(i=0; i<box_list.length; i++){
					box_list[i].transition()
								.duration(800)
								.attr('fill', base_color)
				}
				console.log('freeform cleaned');
				freeformCleared = 1;							
			}

		}

		function alaq(){
			console.log('alaq called');
			//surah 96
			for(i=0; i<box_list.length; i++){

				//if(quran_json_string[i].chapter>=90){
				if(quran_json_string[i].chapter==95){	
					//console.log('setting: ' + i + ' red');
					box_list[i].transition()
    						.duration(400)
    						.attr('fill', 'red')
    						.transition()
    						.duration(400)
    						.attr('fill','black')
    						.transition()
    						.duration(400)
    						.attr('fill','red')
    						.transition()
    						.duration(400)
    						.attr('fill','black')
				}else{
					
					
					box_list[i].transition()
    						.duration(800)
    						.attr('fill', 'rgba(255,255,255,.5)')
					

					/*
					box_list[i].transition()
    						.duration(400)
    						.attr('fill', 'rgba(255,255,255,.5)')
    						.transition()
    						.duration(400)
    						.attr('fill','rgba(0,0,0,.5)')
    						.transition()
    						.duration(400)
    						.attr('fill','rgba(255,255,255,.5)')
    						.transition()
    						.duration(400)
    						.attr('fill','rgba(0,0,0,.5)')    						
					*/
				}
			}

		}

		function surah(){
			//color_list = colors.distinct(114);
			color_idx = [];
			for(i = 0; i<114; i++){
				color_idx.push(i);
			}
			//console.dir(color_idx);
			shuffleArray(color_idx);




			for(i = 0; i<box_list.length; i++){
				chapter = quran_json_string[i].chapter;
				box_list[i].transition()
							.duration(800)
							.attr('fill',d3.hsl(color_idx[[chapter-1]]/114*360, 1, .5));
			}
		}

		function jesus(){
			console.log('calling jesus');
			for(i = 0; i<box_list.length; i++){
				english = quran_json_string[i].english;
				found = 0;	
				if(english.toUpperCase().includes(' ISA ')){
					box_list[i].transition()
    						.duration(400)
    						.attr('fill','white')
    						.transition()
    						.duration(400)
    						.attr('fill','black')
    						.transition()
    						.duration(400)
    						.attr('fill','white')
    						.transition()
    						.duration(400)
    						.attr('fill','black')
					found = 1;
				}
				if(english.toUpperCase().includes(' MARIUM ')){
					box_list[i].transition()
    						.duration(400)
    						.attr('fill','yellow')
    						.transition()
    						.duration(400)
    						.attr('fill','black')
    						.transition()
    						.duration(400)
    						.attr('fill','yellow')
    						.transition()
    						.duration(400)
    						.attr('fill','black')
					found = 1;
				}
				if(!found){
					box_list[i].transition()
								.duration(800)
								.attr('fill','rgba(0,0,0,.5)');
				}
					
			}

		}

		function fatiha(){
			console.log('fatiha called');
			//surah 96
			for(i=0; i<box_list.length; i++){

				//if(quran_json_string[i].chapter>=90){
				if(quran_json_string[i].chapter==1){	
					//console.log('setting: ' + i + ' red');
					box_list[i].transition()
    						.duration(400)
    						.attr('fill', 'red')
    						.transition()
    						.duration(400)
    						.attr('fill','black')
    						.transition()
    						.duration(400)
    						.attr('fill','red')
    						.transition()
    						.duration(400)
    						.attr('fill','black')
				}else{
					
					box_list[i].transition()
    						.duration(800)
    						.attr('fill', 'rgba(255,255,255,.5)')
					
				}
			}
		}

		function prophets(){
			for(i=0; i<box_list.length; i++){
				box_list[i].transition()
							.duration(800)
							.attr('fill', base_color)
			}
		}

		function names(){
				for(i=0; i<box_list.length; i++){
					box_list[i].transition()
								.duration(800)
								.attr('fill', base_color)
				}
		}





		//freeform
		//Surah al-Alaq
		//Surah colors
		//al-fatiha
		//Jesus green, mary purple
		//All prophets table
		//99 names box


		activateFunctions = [];
		activateFunctions[0] = freeform;
		activateFunctions[1] = alaq;
		activateFunctions[2] = surah;
		activateFunctions[3] = fatiha;
		activateFunctions[4] = jesus;
		activateFunctions[5] = prophets;
		activateFunctions[5] = names;

		progressFunctions = [];
		progressFunctions[0] = nada;
		progressFunctions[1] = redP;
		progressFunctions[2] = nada;


		//get section positions:
		sectionPositions = [];
		var startPos;
		d3.selectAll('section').each(function(d,i) {
		  var top = this.getBoundingClientRect().top;

		  if(i === 0) {
		    startPos = top;
		  }
		  sectionPositions.push(top - startPos);
		  console.log('adding section: ' + top);
		});

		currentIndex=-5;
		window.addEventListener('scroll',function(e) {
		    

			var pos = window.pageYOffset+10;
			//console.log("scrolling: " + pos);

			//find first element > pos, select oen right before it:
			greaterSection = -1;
			for(i = 0; i<sectionPositions.length; i++){
				if(pos>sectionPositions[i]){
					greaterSection = i;
				}
			}
			greaterSection = greaterSection + 1;
			var sectionIndex;
			if(greaterSection > 0){
				sectionIndex = greaterSection - 1;
			}else{
				sectionIndex = 0;
			}
			//console.log('setting section index to: ' + sectionIndex);
			//var sectionIndex = d3.bisect(sectionPositions, pos);
			var progress = pos;
			sectionIndex = Math.min(sectionPositions.length - 1, sectionIndex);



			if (currentIndex !== sectionIndex) {
				//dispatch.active(sectionIndex);
				console.log('setting current index to: ' + sectionIndex);
				clearInterval(interval);
			    currentIndex = sectionIndex;
			    console.log('starting interval: ' + sectionIndex);
			    //activateFunctions[sectionIndex]();

			    if(sectionIndex != 5 && sectionIndex != 6){
				    activateFunctions[sectionIndex]();
				    interval = setInterval(function(){activateFunctions[sectionIndex]()},1600);
				    freeformCleared = 0;

			    }else{
			    	activateFunctions[sectionIndex]();
			    }
			    //activateFunctions[sectionIndex]();
			}else{
				//progressFunctions[sectionIndex](progress);
			}


		});






		//Make an SVG Container
		var svgContainer = d3.select(document.getElementById("quran_container")).append("svg")
		var resizeId;
	
		window.addEventListener("resize",function(){
			clearTimeout(resizeId);
			resizeId = setTimeout(redraw, 100);
		});

		var box_list = [];



		//some settings:
		padding_x = 10;
		padding_y = 0.5;
		container_width = 0.4;
		container_height = 0.80;
		box_width = container_width*(window.innerWidth/30 - padding_x);



		factor = 0.01;
		delay = 0;
		console.log('factor: ' + factor);

		base_color = 'rgb(255,0,0)'
		base_color = '#112E44'
		highlight_color = 'rgb(0,100,0)'
		highlight_color = '#FCF0D2'
		select_color = 'rgb(0,0,100)'
		select_color = '#A9A79B'

		bg_color = '#92794D'
		bg_color = '#DDBF8B'

		document.body.style.backgroundColor = bg_color;

		redraw();


		var search_idx_list = [];
		function search(){
			term = document.getElementById("search_text_bar").value;
			console.log('searching for: ' + term.toUpperCase());

			//clear previous search index list:
			for(i = 0; i<search_idx_list.length; i++){
				box_list[search_idx_list[i]].attr('fill',base_color);
			}
			search_idx_list=[];

			for(i = 0; i<6235; i++){
				if(quran_json_string[i].english.toUpperCase().includes(term.toUpperCase())){
					search_idx_list.push(i);
					box_list[i].attr('fill',highlight_color);
				}
			}

		}

		function searchTerm(term){
			console.log('searching for: ' + term.toUpperCase());

			//clear previous search index list:
			for(i = 0; i<search_idx_list.length; i++){
				box_list[search_idx_list[i]].attr('fill',base_color);
			}
			search_idx_list=[];

			for(i = 0; i<6235; i++){
				if(quran_json_string[i].english.toUpperCase().includes(term.toUpperCase())){
					search_idx_list.push(i);
					box_list[i].attr('fill',highlight_color);
				}
			}
		}

		function searchTermArabic(term){
			console.log('searching for: ' + term);

			//clear previous search index list:
			for(i = 0; i<search_idx_list.length; i++){
				box_list[search_idx_list[i]].attr('fill',base_color);
			}
			search_idx_list=[];

			for(i = 0; i<6235; i++){
				if(quran_json_string[i].arabic.includes(term)){
					search_idx_list.push(i);
					box_list[i].attr('fill',highlight_color);
				}
			}
		}

		function handleMouseOver(d,i){
			//console.log('this id: ' + this.id);
			//console.dir(this);
			//console.dir(d);
			//console.dir(i);
			//console.dir(d3.select(this));
			id_num = this.id.substring(3,this.id.length);
			id_num = parseInt(id_num);
			//console.log('found id num: ' + id_num);

			if(search_idx_list.includes(id_num)){
				d3.select(this).attr({
	              fill: "orange"
	            });			
				//this.setAttributeNS(null,'fill','purple');
			}else{
				d3.select(this).attr({
	              fill: select_color
	            });
				//this.setAttributeNS(null,'fill',select_color);
			}

			document.getElementById('arabic_text_p').innerHTML= quran_json_string[id_num].arabic;
			document.getElementById('english_text_p').innerHTML = quran_json_string[id_num].english;
			document.getElementById('juz_text_p').innerHTML ="juz: " + quran_json_string[id_num].juz_number;
			document.getElementById('sura_text_p').innerHTML ="surah: " + quran_json_string[id_num].chapter;
			document.getElementById('aya_text_p').innerHTML ="aya: " + quran_json_string[id_num].verse;
		}

		function handleMouseOut(d,i){
			//console.log('mouse out: ' + this);

			id_num = this.id.substring(3,this.id.length);
			id_num = parseInt(id_num);

			if(search_idx_list.includes(id_num)){
				d3.select(this).attr({
	              fill: highlight_color
	            });
			}else{
				d3.select(this).attr({
	              fill: base_color
	            });
			}

			document.getElementById('arabic_text_p').innerHTML = 'arabic text:';
			document.getElementById('english_text_p').innerHTML = 'english translation:';
			document.getElementById('juz_text_p').innerHTML ='juz number';
			document.getElementById('sura_text_p').innerHTML ='sura number';
			document.getElementById('aya_text_p').innerHTML ='aya number';

			//console.log(this.id);
		}


		function addBox(text, width, start_x, start_y, id_num){
			//factor = 0.01;
			//console.log('adding box, time=' + Date.now());
			
			/*
			var box = document.createElementNS( "http://www.w3.org/2000/svg", 'rect');
			box.setAttributeNS(null, 'x', start_x);
			box.setAttributeNS(null, 'y', start_y);
			box.setAttributeNS(null, 'width', width);
			box.setAttributeNS(null, 'height', factor*text.length);
			box.setAttributeNS(null, 'fill', base_color);
			box.addEventListener('mouseover',mouseOverEffect);
			box.addEventListener('mouseout',mouseoutEffect);
			box.id = "id_" + id_num;
			document.getElementById("gunit").appendChild(box);
*/

			var box = svgContainer.append("rect")
					                            .attr("x", start_x)
					                            .attr("y", start_y)
					                            .attr("width", width)
					                            .attr("height", factor*text.length)
					                            .attr("id", "id_" + id_num)
					                            .attr("fill",base_color)
					                            .on("mouseover", handleMouseOver)
          										.on("mouseout", handleMouseOut);
			box.id = "id_" + id_num;
			box_list.push(box);
			return factor* text.length;
		}


		function redraw()
		{
			console.log("redrawing!");
			// var width = document.getElementById("quran_container").clientWidth;
   //      	var height = document.getElementById("quran_container").clientHeight;
        	var width = window.innerWidth;
        	var height = window.innerHeight;
        	svgContainer
	          .attr("width", width*container_width)
	          .attr("height", height*container_height);
	        box_width = ((container_width*window.innerWidth)/31 - padding_x);


	        //number of ayas in first juz: 111
	        //length of arabic text in first juz (characters): 23959
	        //number of ayas in first juz: 563
	        //length of arabic text in first juz (characters): 21823
	        //height of juz stack = num_ayas*padding + length_arabic*factor
	        //so: factor = (height_juz_stack - (num_ayas*padding))/length_arabic
	        //factor = (height*container_height) / (23170 + padding_y);
			//factor = (height*container_height - 111*padding_y)/23959;
			factor = (height*container_height - 563*padding_y)/21823;
			console.log('setting factor to: ' + factor);

			for(i = 0; i<box_list.length; i++){
				//svgContainer.select(box_list[i]).remove();
				box_list[i].remove();
			}
			box_list=[];
			svgContainer.selectAll("*").remove();

			//setup quran element
			juz_height = [];
			for(juz_counter = 0; juz_counter<30; juz_counter++){
				juz_height[juz_counter] = 0;
			}


			//column length determiend using following code: 23170 characters.
			// col_length = 0;
			// for(i = 0; i<6235; i++){
			// 	aya = quran_json_string[i];
			// 	if(aya.juz_number==1){
			// 		col_length = col_length + aya.arabic.length;
			// 	}
			// }
			// console.log('col length: '  + col_length);

			debug_n_aya_count = 0;
			debug_l_arabic_count = 0;

			for(i = 0; i<6235; i++)
			//for(i = 0; i<1000; i++)
			{
				delay = delay ;//+ .0001;
				aya = quran_json_string[i];
				juz = aya.juz_number-1;
				arabic = aya.arabic;

				super_offset = (svgContainer[0][0].clientWidth - (box_width+padding_x)*30)/2;
				//console.log('super offset: ' + super_offset);

				c_start_x = svgContainer[0][0].clientWidth - super_offset -  (juz*(box_width+padding_x));

				c_start_x = svgContainer[0][0].clientWidth -  ((juz+1)*(box_width+padding_x));
				c_start_y = juz_height[juz];

				//for debugging purposes:
				//console.log("number: " + i + " chapter: " + aya.chapter + " verse: " + aya.verse + " juz: " + juz + " " + box_width + " " + c_start_x + " " + c_start_y);


				//additional_height = setTimeout(addBox(arabic, box_width, c_start_x, c_start_y, i),delay);
				//addBox(arabic,box_width,c_start_x,c_start_y,i);
				setTimeout(addBox,delay,arabic,box_width,c_start_x,c_start_y,i);
				//juz_height[juz] = juz_height[juz]+additional_height;
				juz_height[juz] = juz_height[juz]+arabic.length*factor+padding_y;

				if(juz==29){
					debug_n_aya_count++;
					debug_l_arabic_count = debug_l_arabic_count + arabic.length;
				}
			}
			console.log('number of ayas in 30th juz: ' + debug_n_aya_count);
			console.log('length of arabic in 30th juz: ' + debug_l_arabic_count);
		}





	</script>

	</body>
</html>